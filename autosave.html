

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Auto-saving: simple save/restore of PVs &#8212; Epics Channel Access for Python</title>
    
    <link rel="stylesheet" href="_static/epicsdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.2.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="wx: wxPython Widgets for Epics" href="wx.html" />
    <link rel="prev" title="Alarms: respond when a PV goes out of range" href="alarm.html" /> 
  </head>
  <body>
<div style="background-color: #E7F0F3; text-align: left; padding: 8px 4px 8px 4px">
  <font size=+3><a href="index.html">
      <img src="_static/pyepics.png" height=50 border="0" alt="pyepics"/>
    &nbsp; PyEpics: Epics Channel Access for Python</a>
  </font>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="wx.html" title="wx: wxPython Widgets for Epics"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="alarm.html" title="Alarms: respond when a PV goes out of range"
             accesskey="P">previous</a> |</li>
   <li>[<a href="installation.html">install</a></li>
   <li>|<a href="overview.html">overview</a></li>
   <li>|<a href="pv.html">pv</a></li>
   <li>|<a href="ca.html">ca</a></li>
   <li>|<a href="arrays.html">arrays</a></li>
   <li>|<a href="devices.html">devices</a></li>
   <li>|<a href="alarm.html">alarm</a></li>
   <li>|<a href="#">autosave</a></li>
   <li>|<a href="wx.html">wx</a></li>
   <li>|<a href="advanced.html">advanced</a>]</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Auto-saving: simple save/restore of PVs</a><ul>
<li><a class="reference internal" href="#supported-data-types">Supported Data Types</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="alarm.html"
                        title="previous chapter">Alarms: respond when a PV goes out of range</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="wx.html"
                        title="next chapter">wx: wxPython Widgets for Epics</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/autosave.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-autosave">
<span id="auto-saving-simple-save-restore-of-pvs"></span><h1>Auto-saving: simple save/restore of PVs<a class="headerlink" href="#module-autosave" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="#module-autosave" title="autosave: simple save/restore of PVs"><code class="xref py py-mod docutils literal"><span class="pre">autosave</span></code></a> module provides simple save/restore functionality for
PVs, with the functions <a class="reference internal" href="#autosave.save_pvs" title="autosave.save_pvs"><code class="xref py py-func docutils literal"><span class="pre">save_pvs()</span></code></a> and <a class="reference internal" href="#autosave.restore_pvs" title="autosave.restore_pvs"><code class="xref py py-func docutils literal"><span class="pre">restore_pvs()</span></code></a>.  These
are similar to the autosave module from synApps for IOCs in that they use a
compatible <em>request file</em> which describes the PVs to save, and a compatible
<em>save file</em> which holds the saved values. Of course, the reading and
writing is done here via Channel Access, and need not be related to any
particular running IOC.</p>
<p>Use of this module requires the <a class="reference external" href="http://pyparsing.wikispaces.com/">pyparsing package</a> to be installed.  This is a fairly
common third-party python package, included in many package managers, or
installed with tools such as <em>easy_install</em> or <em>pip</em>, or downloaded from
<a class="reference external" href="http://pypi.python.org/pypi/pyparsing">PyPI</a></p>
<p>Request and Save file formats are designed to be compatible with synApps
autosave.  Notably, the <cite>file</cite> command with macro substitutions are
supported, so that one can have a Request like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># My.req</span>
<span class="n">file</span> <span class="s2">&quot;SimpleMotor.req&quot;</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">IOC</span><span class="p">:,</span> <span class="n">Q</span><span class="o">=</span><span class="n">m1</span>
</pre></div>
</div>
<p>with a  <strong>SimpleMotor.req</strong> file of:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span># SimpleMotor.req
$(P)$(Q).VAL
$(P)$(Q).DIR
$(P)$(Q).FOFF
</pre></div>
</div>
<p>which can then be used for many instances of a SimpleMotor.  There is,
however, no mechanism for automatically finding request files.</p>
<p>With such a file, simply using:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epics.autosave</span>
<span class="n">epics</span><span class="o">.</span><span class="n">autosave</span><span class="o">.</span><span class="n">save_pvs</span><span class="p">(</span><span class="s2">&quot;My.req&quot;</span><span class="p">,</span> <span class="s2">&quot;my_values.sav&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>will save the current values for the PVs to the file <strong>my_values.sav</strong>.  At
a later time, these values can be restored with</p>
<blockquote>
<div>import epics.autosave
epics.autosave.restore_pvs(“my_values.sav”)</div></blockquote>
<p>The saved file will be of nearly identical format as that of the autosave
mechanism, and the <a class="reference internal" href="#autosave.restore_pvs" title="autosave.restore_pvs"><code class="xref py py-func docutils literal"><span class="pre">restore_pvs()</span></code></a> function can read and restore values
using save files from autosave.  Note, however, that the purpose here is
quite different from that of the standard autosave module (which is
designed to save vales so that PVs can be <strong>initialized</strong> at IOC startup).
Using the functions here will really do a <code class="xref py py-func docutils literal"><span class="pre">caput()</span></code> to the saved
values.</p>
<dl class="function">
<dt id="autosave.save_pvs">
<code class="descclassname">autosave.</code><code class="descname">save_pvs</code><span class="sig-paren">(</span><em>request_file</em>, <em>save_file</em><span class="sig-paren">)</span><a class="headerlink" href="#autosave.save_pvs" title="Permalink to this definition">¶</a></dt>
<dd><p>saves current value of PVs listed in <em>request_file</em> to the <em>save_file</em></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>request_file</strong> – name of Request file to read PVs to save.</li>
<li><strong>save_file</strong> – name of file to save values to write values to</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>As discussed above, the <strong>request_file</strong> follows the conventions of the
autosave module from synApps.</p>
</dd></dl>

<dl class="function">
<dt id="autosave.restore_pvs">
<code class="descclassname">autosave.</code><code class="descname">restore_pvs</code><span class="sig-paren">(</span><em>save_file</em><span class="sig-paren">)</span><a class="headerlink" href="#autosave.restore_pvs" title="Permalink to this definition">¶</a></dt>
<dd><p>reads values from <em>save_file</em> and restores them for the corresponding PVs</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>save_file</strong> – name of file to save values to read data from.</td>
</tr>
</tbody>
</table>
<p>Note that <a class="reference internal" href="#autosave.restore_pvs" title="autosave.restore_pvs"><code class="xref py py-func docutils literal"><span class="pre">restore_pvs()</span></code></a> will restore all the values it can, skipping
over any values that it cannot restore.</p>
</dd></dl>

<div class="section" id="supported-data-types">
<h2>Supported Data Types<a class="headerlink" href="#supported-data-types" title="Permalink to this headline">¶</a></h2>
<p>All scalar PV values can be saved and restored with the <a class="reference internal" href="#module-autosave" title="autosave: simple save/restore of PVs"><code class="xref py py-mod docutils literal"><span class="pre">autosave</span></code></a>
routines.  There is some support for waveform (array) data.  For example,
character waveforms containing for long strings can be saved and restored.
In addition, numerical arrays in waveform can be saved and restored.  For
array data, the results may not be fully compatible with the autosave
module.</p>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>A simple example usign the autosave module:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epics.autosave</span>
<span class="c1"># save values</span>
<span class="n">epics</span><span class="o">.</span><span class="n">autosave</span><span class="o">.</span><span class="n">save_pvs</span><span class="p">(</span><span class="s2">&quot;my_request_file.req&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;/tmp/my_recent_save.sav&quot;</span><span class="p">)</span>

<span class="c1"># wait 30 seconds</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="c1"># restore those values back</span>
<span class="n">epics</span><span class="o">.</span><span class="n">autosave</span><span class="o">.</span><span class="n">restore_pvs</span><span class="p">(</span><span class="s2">&quot;/tmp/my_recent_save.sav&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="wx.html" title="wx: wxPython Widgets for Epics"
             >next</a> |</li>
        <li class="right" >
          <a href="alarm.html" title="Alarms: respond when a PV goes out of range"
             >previous</a> |</li>
   <li>[<a href="installation.html">install</a></li>
   <li>|<a href="overview.html">overview</a></li>
   <li>|<a href="pv.html">pv</a></li>
   <li>|<a href="ca.html">ca</a></li>
   <li>|<a href="arrays.html">arrays</a></li>
   <li>|<a href="devices.html">devices</a></li>
   <li>|<a href="alarm.html">alarm</a></li>
   <li>|<a href="#">autosave</a></li>
   <li>|<a href="wx.html">wx</a></li>
   <li>|<a href="advanced.html">advanced</a>]</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, Matthew Newville.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.2.
    </div>
  </body>
</html>